version: "3.1"

assistant_id: 20250614-141044-some-commission
language: en

pipeline:
  # ─ Tokenização e Features Básicas
  - name: WhitespaceTokenizer
  - name: RegexFeaturizer
    use_word_boundaries: true
  - name: LexicalSyntacticFeaturizer

  # ─ Count Vectors (palavras)
  - name: CountVectorsFeaturizer
    analyzer: word
    min_ngram: 1
    max_ngram: 1
    min_df: 2              # ignora palavras que aparecem só 1x (ruído, reduz vocabulário)
    OOV_token: "__oov__"   # termo fora de vocabulário cai aqui

  # ─ Count Vectors (subpalavras / char n-grams)
  - name: CountVectorsFeaturizer
    analyzer: char_wb
    min_ngram: 3           # começa em 3 letras (mais sinal, menos lixo)
    max_ngram: 5
    min_df: 2              # ↓ mais sensível a padrões PT/EN, sem encher de lixo

  # ─ Classificação de Intents (DIET bem treinado)
  - name: DIETClassifier
    epochs: 50             # 50 epochs pra ~60k exemplos é um bom equilíbrio
    batch_size: [64, 256]  # minibatch aumenta com o tempo (treino mais estável)
    learning_rate: 0.001
    embedding_dimension: 128
    constrain_similarities: true

  # ─ FallbackClassifier: só dispara em casos realmente ruins
  - name: FallbackClassifier
    threshold: 0.3           # ↓ menos agressivo; aceita intents úteis de 0.3+ em produção
    ambiguity_threshold: 0.05 # ambíguo só quando intents muito próximas

  # ─ Sinônimos de entidades
  - name: EntitySynonymMapper

  # ─ Response Selector (se um dia usar retrieval intents)
  - name: ResponseSelector
    epochs: 20
    constrain_similarities: true

policies:
  # ─ Memoization para histórias exatas
  - name: MemoizationPolicy
    max_history: 10          # 10 já cobre bem teu fluxo de entrevista

  # ─ RulePolicy: ainda sabe chamar o fallback, mas menos agressivo
  - name: RulePolicy
    core_fallback_action_name: "action_fallback"
    enable_fallback_prediction: true
    core_fallback_threshold: 0.3

  # ─ Lida com intents inesperadas / comportamento estranho
  - name: UnexpecTEDIntentPolicy
    nlu_intent_threshold: 0.3

  # ─ TED para generalização de diálogos
  - name: TEDPolicy
    max_history: 5
    epochs: 30               # um pouco mais de treino pra ~300 intents
    constrain_similarities: true
